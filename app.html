<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spinning Wheel Name Picker</title>
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --panel:#111827; /* gray-900 */
      --ink:#e5e7eb; /* gray-200 */
      --muted:#9ca3af; /* gray-400 */
      --accent:#60a5fa; /* blue-400 */
      --accent-2:#34d399; /* emerald-400 */
      --danger:#f87171; /* red-400 */
      --ring: rgba(96,165,250,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
      background: radial-gradient(1200px 800px at 80% -20%, #1f2937 0%, var(--bg) 60%);
      color: var(--ink);
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{width:min(1100px,100%); display:grid; gap:18px; grid-template-columns: 360px 1fr;}
    @media (max-width: 900px){ .app{grid-template-columns: 1fr} }
    .card{background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:16px; box-shadow: 0 10px 30px rgba(0,0,0,.35);}
    .panel{padding:18px}
    h1{font-size:22px; margin:0 0 8px; letter-spacing:.2px}
    p{margin:0 0 12px; color:var(--muted)}
    textarea{
      width:100%; min-height:150px; resize:vertical; color:var(--ink); background:#0b1020; border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:12px; line-height:1.35;
      outline:none; box-shadow: 0 0 0 0 transparent; transition: box-shadow .2s, border-color .2s;
    }
    textarea:focus{ border-color: var(--accent); box-shadow: 0 0 0 4px var(--ring); }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .btn{appearance:none; border:none; border-radius:12px; padding:10px 14px; color:#0b1020; background:var(--accent); font-weight:600; cursor:pointer; box-shadow:0 6px 18px rgba(96,165,250,.35); transition: transform .06s ease, filter .2s ease;}
    .btn.secondary{ background: var(--accent-2); box-shadow:0 6px 18px rgba(52,211,153,.35)}
    .btn.ghost{ background:transparent; color:var(--ink); border:1px solid rgba(255,255,255,.15)}
    .btn:active{ transform: translateY(1px) }
    .pillbox{ display:flex; flex-wrap:wrap; gap:8px; margin-top:12px; max-height: 120px; overflow:auto; padding-right:6px }
    .pill{ background:#0b1020; border:1px solid rgba(255,255,255,.12); color:var(--ink); padding:6px 10px; border-radius:999px; font-size:12px; display:inline-flex; align-items:center; gap:6px }
    .pill button{ all:unset; cursor:pointer; color:var(--muted); }
    .wheel-wrap{ position:relative; display:grid; place-items:center; padding:16px }
    canvas{ width:100%; height:auto; max-width:600px; aspect-ratio:1 / 1; display:block; margin:auto; }
    .pointer{ position:absolute; top:10px; width:min(7.5%, 42px); aspect-ratio:1/1; background: var(--danger); clip-path: polygon(50% 0%, 0% 100%, 100% 100%); filter: drop-shadow(0 10px 10px rgba(0,0,0,.35)); transform: rotate(180deg);}
    .result{ text-align:center; padding:12px 16px; border-top:1px dashed rgba(255,255,255,.15); font-weight:600 }
    .subtle{ color:var(--muted); font-weight:400 }
    .footer{ text-align:center; color:var(--muted); font-size:12px; padding:10px 0 0 }
    .hidden{ display:none }
  </style>
</head>
<body>
  <div class="app">
    <!-- Left: Controls -->
    <section class="card panel">
      <h1>Spinning Wheel Picker</h1>
      <p>Enter one name per line (or commaâ€‘separated), then click <strong>Build Wheel</strong>. Hit <strong>Spin</strong> to choose a random winner.</p>
      <textarea id="namesInput" placeholder="e.g. Alan\nTaylor\nCasey\nPriya"></textarea>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="buildBtn">Build Wheel</button>
        <button class="btn secondary" id="spinBtn">Spin</button>
        <button class="btn ghost" id="shuffleBtn" title="Shuffle current names">Shuffle</button>
        <button class="btn ghost" id="clearBtn" title="Clear names">Clear</button>
      </div>
      <div class="pillbox" id="pillbox"></div>
      <div class="footer">Tip: You can click a name pill to remove it.</div>
    </section>

    <!-- Right: Wheel -->
    <section class="card">
      <div class="wheel-wrap panel">
        <div class="pointer" aria-hidden="true"></div>
        <canvas id="wheel" width="900" height="900" aria-label="Name wheel"></canvas>
      </div>
      <div class="result" id="result"><span class="subtle">No spin yet.</span></div>
    </section>
  </div>

  <script>
    const input = document.getElementById('namesInput');
    const buildBtn = document.getElementById('buildBtn');
    const spinBtn = document.getElementById('spinBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const clearBtn = document.getElementById('clearBtn');
    const pillbox = document.getElementById('pillbox');
    const resultEl = document.getElementById('result');

    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');

    let names = [];
    let rotation = 0; // current rotation (radians)
    let animId = null;

    function parseNames(text){
      return Array.from(new Set(text
        .split(/\n|,/g)
        .map(s => s.trim())
        .filter(Boolean)
      ));
    }

    function updatePills(){
      pillbox.innerHTML = '';
      names.forEach((n,i)=>{
        const pill = document.createElement('span');
        pill.className = 'pill';
        pill.innerHTML = `<span>${escapeHtml(n)}</span>`;
        pill.title = 'Click to remove';
        pill.addEventListener('click', ()=>{ names.splice(i,1); drawWheel(rotation); updatePills(); });
        pillbox.appendChild(pill);
      });
    }

    function escapeHtml(str){
      return str.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
    }

    function buildWheel(){
      const parsed = parseNames(input.value);
      if(parsed.length === 0){
        // Fill with placeholders to show the wheel nicely
        names = ['Add','Some','Names'];
      } else {
        names = parsed;
      }
      rotation = 0;
      drawWheel(rotation);
      updatePills();
      resultEl.innerHTML = '<span class="subtle">Wheel ready. Press <strong>Spin</strong>.</span>';
    }

    function drawWheel(rot){
      const W = canvas.width, H = canvas.height;
      const cx = W/2, cy = H/2; const r = Math.min(W,H)/2 - 12;
      ctx.clearRect(0,0,W,H);
      const n = Math.max(1, names.length);
      const arc = (Math.PI*2) / n;

      // draw slices
      for(let i=0;i<n;i++){
        const start = i*arc + rot;
        const end = start + arc;
        // alternating color palette
        ctx.beginPath();
        ctx.moveTo(cx,cy);
        ctx.arc(cx,cy,r,start,end);
        ctx.closePath();
        const hue = (i* 360/n);
        ctx.fillStyle = `hsl(${hue}deg 70% 45%)`;
        ctx.fill();
        ctx.lineWidth = 2;
        ctx.strokeStyle = 'rgba(255,255,255,.25)';
        ctx.stroke();

        // text
        ctx.save();
        ctx.translate(cx,cy);
        ctx.rotate(start + arc/2);
        ctx.textAlign = 'right';
        ctx.fillStyle = 'white';
        ctx.font = `${Math.max(16, Math.floor(r*0.08))}px system-ui, -apple-system, Segoe UI, Roboto, Inter, Ubuntu, Arial`;
        const label = names[i] ?? '';
        wrapText(ctx, label, r - 16, Math.floor(r*0.18));
        ctx.restore();
      }

      // center circle
      ctx.beginPath();
      ctx.arc(cx,cy, Math.max(24, r*0.18), 0, Math.PI*2);
      ctx.fillStyle = '#0b1020';
      ctx.fill();
      ctx.lineWidth = 3;
      ctx.strokeStyle = 'rgba(255,255,255,.25)';
      ctx.stroke();

      // rim
      ctx.beginPath();
      ctx.arc(cx,cy,r+2,0,Math.PI*2);
      ctx.lineWidth = 6;
      ctx.strokeStyle = 'rgba(255,255,255,.15)';
      ctx.stroke();
    }

    function wrapText(ctx, text, maxWidth, lineHeight){
      const words = (text+"").split(/\s+/);
      let line = '';
      const lines = [];
      for(const w of words){
        const test = line ? line + ' ' + w : w;
        if(ctx.measureText(test).width > maxWidth && line){
          lines.push(line);
          line = w;
        } else {
          line = test;
        }
      }
      if(line) lines.push(line);
      const yStart = 6 - ((lines.length-1) * lineHeight)/2;
      lines.forEach((ln, idx)=>{
        ctx.fillText(ln, maxWidth, yStart + idx*lineHeight);
      });
    }

    function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

    function spin(){
      if(names.length === 0){ buildWheel(); }
      cancelAnimationFrame(animId);

      const n = names.length || 1;
      const arc = (Math.PI*2)/n;
      const targetIndex = Math.floor(Math.random()*n);

      // pointer is at -90deg (12 o'clock). We want the center of target slice at pointer.
      const targetAngleAtPointer = -Math.PI/2;
      const sliceCenter = targetIndex*arc + arc/2;
      let finalRotation = targetAngleAtPointer - sliceCenter;
      // add full spins plus a small random offset to feel natural
      const extraSpins = 5 + Math.floor(Math.random()*3); // 5â€“7 spins
      finalRotation += extraSpins * (Math.PI*2);

      const start = rotation;
      const delta = normalize(finalRotation - start);
      const duration = 3500 + Math.random()*1200; // ms
      const t0 = performance.now();

      function frame(t){
        const p = Math.min(1, (t - t0)/duration);
        const eased = easeOutCubic(p);
        rotation = start + delta * eased;
        drawWheel(rotation);
        if(p < 1){
          animId = requestAnimationFrame(frame);
        } else {
          // lock to exact final angle and announce winner
          rotation = start + delta;
          drawWheel(rotation);
          const winner = names[targetIndex] || '';
          resultEl.innerHTML = `ðŸŽ‰ Winner: <strong>${escapeHtml(winner)}</strong>`;
          confettiBurst();
        }
      }
      animId = requestAnimationFrame(frame);
    }

    function normalize(a){
      // ensure we rotate the long way if negative or too small; force at least 3 full spins
      const twoPi = Math.PI*2;
      while(a < twoPi*3) a += twoPi; // guarantee multiple spins
      return a;
    }

    function shuffleInPlace(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    }

    // Tiny confetti
    function confettiBurst(){
      const W = canvas.width, H = canvas.height;
      const cx = W/2, cy = H/2;
      const particles = Array.from({length: 80}, (_,i)=>({
        x: cx, y: cy, r: 2 + Math.random()*3,
        a: Math.random()*Math.PI*2,
        v: 3 + Math.random()*5,
        life: 40 + Math.random()*40,
        hue: Math.floor(Math.random()*360)
      }));
      let tick = 0;
      const base = ctx.getImageData(0,0,W,H); // freeze wheel
      function step(){
        ctx.putImageData(base,0,0);
        particles.forEach(p=>{
          p.x += Math.cos(p.a)*p.v;
          p.y += Math.sin(p.a)*p.v + 0.25*tick/20; // gravity
          p.life -= 1;
          ctx.beginPath();
          ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
          ctx.fillStyle = `hsl(${p.hue} 90% 60% / ${Math.max(0,p.life/60)})`;
          ctx.fill();
        });
        tick++;
        if(tick < 60) requestAnimationFrame(step); else drawWheel(rotation);
      }
      requestAnimationFrame(step);
    }

    // Events
    buildBtn.addEventListener('click', buildWheel);
    spinBtn.addEventListener('click', spin);
    shuffleBtn.addEventListener('click', ()=>{ if(names.length){ shuffleInPlace(names); drawWheel(rotation); updatePills(); }});
    clearBtn.addEventListener('click', ()=>{ names = []; input.value=''; updatePills(); drawWheel(0); resultEl.innerHTML = '<span class="subtle">Cleared. Add names to begin.</span>'; });

    // Seed demo
    input.value = 'Alan\nTaylor\nCasey\nPriya\nJordan\nSam';
    buildWheel();

    // Resize handling: scale the internal canvas to keep crisp text
    function handleResize(){
      const rect = canvas.getBoundingClientRect();
      const size = Math.floor(Math.min(rect.width, rect.height));
      const ratio = window.devicePixelRatio || 1;
      canvas.width = Math.floor(size * ratio);
      canvas.height = Math.floor(size * ratio);
      drawWheel(rotation);
    }
    new ResizeObserver(handleResize).observe(canvas);
    window.addEventListener('orientationchange', handleResize);

  </script>
</body>
</html>
